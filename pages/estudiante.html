<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cargar Proyecto</title>
  <link rel="shortcut icon" href="../img/Group-61.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.1.1/css/all.css">
  <link rel="stylesheet" href="../css/style2.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="sweetalert2.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;900&display=swap" rel="stylesheet">
</head>

<body>
  <nav>
    <a href="#" title="EdVisto">
      <img src="../img/edvisto-logo.png.webp" alt="edvisto-logo" class="logo">
    </a>
    <a href="#" class="menu">
      <span class="fa fa-bars"></span>
      <span class="label">MENÚ</span>
    </a>
    <a href="#vid" class="video">
      <span class="fas fa-film"></span>
      <span class="label">Mis Videos</span>
    </a>
    <a href="#cal" class="notas">
      <span class="fas fa-medal"></span>
      <span class="label">Calificaciones</span>
    </a>
    <a class="salir" href="#" onClick="localStorage.removeItem('user'); window.location.href = '../index.html'">
      <span class="fas fa-sign-in-alt"></span>
      <span class="label">Salir</span>
    </a>
  </nav>
  <div class="container">
    <p class="email-ingreso"><span id="emailEstudiante"></span></p>
    <img src="../img/Group-2319.png" alt="mensaje de bienvenida" class="bienvenida">
    <h1 class="titulo uno">CARGAR PROYECTO</h1>
    <p class="subtitulo-titulo">Completa con los datos para que la información llegue a tu profesor.</p>

    <div class="form-container">
      <form name="formulario" class="informacion" action="">
        <fieldset>
          <div class="form-group">

            <label class="email-profesor">EMAIL DEL PROFESOR</label><br>
            <input type="email" name="email-profesor" id="email-profesor" placeholder="E-MAIL DEL PROFESOR"
              maxlength="60" onkeyup="this.value = this.value.toUpperCase();"><br>

            <label class="nombre-lider">NOMBRE COMPLETO DEL LIDER</label><br>
            <input type="text" name="nombre-lider" id="nombre-lider" placeholder="NOMBRE COMPLETO DEL LÍDER"
              maxlength="60" onkeyup="this.value = this.value.toUpperCase();"><br>

            <label class="email-lider">EMAIL DEL LIDER</label><br>
            <input type="email" name="email-lider" id="email-lider" placeholder="E-MAIL DEL LÍDER DEL PROYECTO"
              maxlength="60" onkeyup="this.value = this.value.toUpperCase();"><br>

            <label class="nombre-lider">TITULO DEL PROYECTO</label><br>
            <input type="text" name="titulo-proyecto" id="titulo-proyecto" placeholder="AGREGA EL NOMBRE DEL PROYECTO"
              maxlength="60" onkeyup="this.value = this.value.toUpperCase();"><br>

            <button type="submit" class="submit-button guardar"><i class='fas fa-download'></i> GUARDAR</button>
          </div>
        </fieldset>
      </form>

      <button id="vid" class="accordion blue titulo-proceso">1- PRIMEROS PASOS</button>
      <div class="panel">
        <p class="subtitulo-proceso">En este video, el grupo se presenta, y comienza su camino. Pueden contar sus
          propuestas y expectativas. No duden en consultar con su docente.</p>

        <div class="form-url">
          <i class="fa-brands fa-youtube"></i>
          <i class="fas fa-link"></i>
          <input type="url" id="url" name="url" placeholder="Pegar link de Youtube">
          <button type="submit" class="submit-button listo"><i class='far fa-paper-plane'></i> ¡LISTO!</button>
        </div>
      </div>

      <button class="accordion blue titulo-proceso">2- ¡MANOS A LA OBRA!</button>
      <div class="panel">
        <p class="subtitulo-proceso">Es momento de llevar a la práctica nuestras ideas, documentando cada paso ¡A
          experimentar! Acerquen sus inquietudes al docente.</p>

        <div class="form-url">
          <i class="fa-brands fa-youtube"></i>
          <i class="fas fa-link"></i>
          <input type="url" id="url" name="url" placeholder="Pegar link de Youtube">
          <button type="submit" class="submit-button listo"><i class='far fa-paper-plane'></i> ¡LISTO!</button>
        </div>
      </div>

      <button class="accordion blue titulo-proceso">3- ¿QUÉ APRENDIMOS?</button>
      <div class="panel">
        <p class="subtitulo-proceso">Repasando las tareas anteriores, como grupo pueden comentar sus reflexiones,
          opiniones y conclusiones. No olviden conversar sobre su trabajo en equipo, los obstáculos y qué les pareció la
          actividad. Compartan con el docente cualquier pregunta que tengan.</p>

        <div class="form-url">
          <i class="fa-brands fa-youtube"></i>
          <i class="fas fa-link"></i>
          <input type="url" id="url" name="url" placeholder="Pegar link de Youtube">
          <button type="submit" class="submit-button listo"><i class='far fa-paper-plane'></i> ¡LISTO!</button>
        </div>
      </div>

      <div class="calificaciones" id="cal">
        <h1 class="titulo dos">CALIFICACIONES</h1>
        <p class="subtitulo-titulo">Aquí encontrarás las notas que realice tu profesor al evaluar los videos enviados.</p>

        <button class="accordion green titulo-proceso">1- PRIMEROS PASOS</button>
        <div class="panel" id="cal-1">
          <p class="subtitulo-proceso">TODAVÍA NO HAY CALIFICACIONES PARA MOSTRAR</p>
        </div>

        <button class="accordion green titulo-proceso">2- ¡MANOS A LA OBRA!</button>
        <div class="panel">
          <p class="subtitulo-proceso">TODAVÍA NO HAY CALIFICACIONES PARA MOSTRAR</p>
        </div>

        <button class="accordion green titulo-proceso">3- ¿QUÉ APRENDIMOS?</button>
        <div class="panel">
          <p class="subtitulo-proceso">TODAVÍA NO HAY CALIFICACIONES PARA MOSTRAR</p>
        </div>
      </div>
    </div>
    <div class="footer">
      <a href="../index.html" class="texto-footer">Salir</a>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>

      // Obtener el correo electrónico migrado de localStorage
      var emailEstudiante = localStorage.getItem("emailEstudiante");

      // Mostrar el correo electrónico en el elemento con el ID "emailEstudiante"
      document.getElementById("emailEstudiante").textContent = emailEstudiante;
      //

      var acc = document.getElementsByClassName("accordion");
      var i;
      for (i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function () {
          this.classList.toggle("active");
          var panel = this.nextElementSibling;
          if (panel.style.display === "block") {
            panel.style.display = "none";
          } else {
            panel.style.display = "block";
          }
        });
      }

      function validarEmail(email) {
      var regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return regex.test(email);
    }

  document.addEventListener('DOMContentLoaded', function () {
    var form = document.forms['formulario'];
    var guardarButton = form.querySelector('.guardar');
    var emailProfesor = form.elements['email-profesor'];
    var emailLider = form.elements['email-lider'];

    guardarButton.addEventListener('click', function (event) {
      event.preventDefault();

      var inputs = form.querySelectorAll('input');
      var completo = true;

      inputs.forEach(function (input) {
        if (input.value.trim() === '') {
          completo = false;
          return;
        }
      });

      if (!completo) {
        Swal.fire({
          text: 'Por favor completar todos los campos',
          confirmButtonColor: '#354760',
        });
        return;
      }

      if (!validarEmail(emailProfesor.value)) {
        Swal.fire({
          text: 'Por favor, ingresa un email válido para el profesor.',
          confirmButtonColor: '#354760',
        });
        return;
      }

      if (!validarEmail(emailLider.value)) {
        Swal.fire({
          text: 'Por favor, ingresa un email válido para el líder del proyecto.',
          confirmButtonColor: '#354760',
        });
        return;
      }

      function getFormData(form) {
        const formData = new FormData(form);
        return Object.fromEntries(formData);
      }

      const formObj = getFormData(form);
      const user = JSON.parse(localStorage.getItem('user'));
      localStorage.setItem(user.email, JSON.stringify(formObj));
      Swal.fire({
        text: 'Sus datos han sido guardados',
        confirmButtonColor: '#354760',
      });

      inputs.forEach(function (input) {
        input.disabled = true;
        input.style.backgroundColor = '#D8D8D8';
      });
    });
  });

      document.addEventListener("DOMContentLoaded", function () {
        const user = JSON.parse(localStorage.getItem('user'));
        const project = JSON.parse(localStorage.getItem(user.email));
        if (project && project.status) {
          const calificacion = project.status === 'approved' ? 'Video Aprobado' : 'Video Desaprobado';
          document.getElementById('cal-1').innerHTML = `
        <p class="subtitulo-proceso">${calificacion}</p>
      `;
        }
        var accordionButtons = document.querySelectorAll(".accordion");

        accordionButtons.forEach(function (button) {
          var submitButton = button.nextElementSibling.querySelector(".submit-button.listo");
          var urlInput = button.nextElementSibling.querySelector("#url");

          submitButton.addEventListener("click", function () {
            var urlValue = urlInput.value.trim();
          
            if (urlValue === "") {
              swal.fire({
                icon: 'warning',
                title: 'Debes pegar el link de YouTube',
                showConfirmButton: false,
                timer: 1500
              });
            } else {
              swal.fire({
                icon: 'warning',
                title: 'Estás por enviar el link junto con su información',
                text: 'No podrá editarse nuevamente. ¿Deseas continuar?',
                showCancelButton: true,
                confirmButtonText: 'Sí',
                cancelButtonText: 'No'
              }).then((result) => {
                if (result.isConfirmed) {
                  const user = JSON.parse(localStorage.getItem('user'));
                  const project = JSON.parse(localStorage.getItem(user.email));
                  localStorage.setItem(user.email, JSON.stringify({ ...project, link: urlValue }));
                  localStorage.setItem('submitted', JSON.stringify([user.email]));
                  swal.fire({
                    icon: 'success',
                    title: '¡Felicidades, ya subiste tu video!',
                    text: 'Se lo enviamos a tu profesor para que pueda evaluarlo',
                    showConfirmButton: false,
                    timer: 1500
                  });
                  urlInput.disabled = true;
                  urlInput.style.backgroundColor = '#D8D8D8';
                  submitButton.disabled = true;
                  style.backgroundColor = 'lightgray';
                }
        });
      }
    });
  });
})
</script>
</body>
</html>